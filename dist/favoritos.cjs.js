/**
* favoritos
*
* @version 0.0.1-beta.0
* @author webistomin
* @email: webistomin@gmail.com
* @license: MIT
*
**/

"use strict";function t(t,n,e){return t(e={path:n,exports:{},require:function(t,n){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==n&&e.path)}},e.exports),e.exports}var n=t((function(t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)})),e=t((function(t){var n=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)})),o=(e.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),i=function(t){if(!o(t))throw TypeError(t+" is not an object!");return t},r=function(t){try{return!!t()}catch(t){return!0}},c=!r((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),a=n.document,s=o(a)&&o(a.createElement),h=!c&&!r((function(){return 7!=Object.defineProperty((t="div",s?a.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),u=Object.defineProperty,f={f:c?Object.defineProperty:function(t,n,e){if(i(t),n=function(t,n){if(!o(t))return t;var e,i;if(n&&"function"==typeof(e=t.toString)&&!o(i=e.call(t)))return i;if("function"==typeof(e=t.valueOf)&&!o(i=e.call(t)))return i;if(!n&&"function"==typeof(e=t.toString)&&!o(i=e.call(t)))return i;throw TypeError("Can't convert object to primitive value")}(n,!0),i(e),h)try{return u(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},l=c?function(t,n,e){return f.f(t,n,function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}(1,e))}:function(t,n,e){return t[n]=e,t},d={}.hasOwnProperty,v=function(t,n){return d.call(t,n)},g=0,p=Math.random(),C=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++g+p).toString(36))},m=t((function(t){var o=n["__core-js_shared__"]||(n["__core-js_shared__"]={});(t.exports=function(t,n){return o[t]||(o[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),y=m("native-function-to-string",Function.toString),b=t((function(t){var o=C("src"),i=(""+y).split("toString");e.inspectSource=function(t){return y.call(t)},(t.exports=function(t,e,r,c){var a="function"==typeof r;a&&(v(r,"name")||l(r,"name",e)),t[e]!==r&&(a&&(v(r,o)||l(r,o,t[e]?""+t[e]:i.join(String(e)))),t===n?t[e]=r:c?t[e]?t[e]=r:l(t,e,r):(delete t[e],l(t,e,r)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[o]||y.call(this)}))})),w=function(t,n,e){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,o){return t.call(n,e,o)};case 3:return function(e,o,i){return t.call(n,e,o,i)}}return function(){return t.apply(n,arguments)}},T=function(t,o,i){var r,c,a,s,h=t&T.F,u=t&T.G,f=t&T.S,d=t&T.P,v=t&T.B,g=u?n:f?n[o]||(n[o]={}):(n[o]||{}).prototype,p=u?e:e[o]||(e[o]={}),C=p.prototype||(p.prototype={});for(r in u&&(i=o),i)a=((c=!h&&g&&void 0!==g[r])?g:i)[r],s=v&&c?w(a,n):d&&"function"==typeof a?w(Function.call,a):a,g&&b(g,r,a,t&T.U),p[r]!=a&&l(p,r,s),d&&C[r]!=a&&(C[r]=a)};n.core=e,T.F=1,T.G=2,T.S=4,T.P=8,T.B=16,T.W=32,T.U=64,T.R=128;var x,E,O=T,S={}.toString,P=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==function(t){return S.call(t).slice(8,-1)}(t)?t.split(""):Object(t)},I=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},_=function(t){return P(I(t))},j=Math.ceil,k=Math.floor,L=function(t){return isNaN(t=+t)?0:(t>0?k:j)(t)},R=Math.min,M=Math.max,B=Math.min,F=m("keys"),H=(x=!1,function(t,n,e){var o,i,r=_(t),c=(o=r.length)>0?R(L(o),9007199254740991):0,a=function(t,n){return(t=L(t))<0?M(t+n,0):B(t,n)}(e,c);if(x&&n!=n){for(;c>a;)if((i=r[a++])!=i)return!0}else for(;c>a;a++)if((x||a in r)&&r[a]===n)return x||a||0;return!x&&-1}),W=F[E="IE_PROTO"]||(F[E]=C(E)),A="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),D=Object.keys||function(t){return function(t,n){var e,o=_(t),i=0,r=[];for(e in o)e!=W&&v(o,e)&&r.push(e);for(;n.length>i;)v(o,e=n[i++])&&(~H(r,e)||r.push(e));return r}(t,A)},G={f:Object.getOwnPropertySymbols},N={f:{}.propertyIsEnumerable},q=function(t){return Object(I(t))},z=Object.assign,U=!z||r((function(){var t={},n={},e=Symbol(),o="abcdefghijklmnopqrst";return t[e]=7,o.split("").forEach((function(t){n[t]=t})),7!=z({},t)[e]||Object.keys(z({},n)).join("")!=o}))?function(t,n){for(var e=q(t),o=arguments.length,i=1,r=G.f,a=N.f;o>i;)for(var s,h=P(arguments[i++]),u=r?D(h).concat(r(h)):D(h),f=u.length,l=0;f>l;)s=u[l++],c&&!a.call(h,s)||(e[s]=h[s]);return e}:z;O(O.S+O.F,"Object",{assign:U});t((function(t){var n=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)})).version;O(O.S+O.F,"Object",{assign:U});var V,J,K;e.Object.assign;!function(t){t.CIRCLE="circle",t.RECT="rectangle"}(V||(V={})),function(t){t.TOP_LEFT="top-left",t.TOP_RIGHT="top-right",t.BOTTOM_LEFT="bottom-left",t.BOTTOM_RIGHT="bottom-right"}(J||(J={})),function(t){t.NONE="none",t.POP="pop",t.SLIDE="slide",t.FADE="fade",t.POP_FADE="popfade"}(K||(K={}));var Q={icon:{iconSelector:'link[rel*="icon"]',backgroundColor:"#d21f3c",shape:V.CIRCLE,lineWidth:4,width:32,height:32},badge:{fontSize:18,fontFamily:"Helvetica, Arial, sans-serif",backgroundColor:"#d21f3c",color:"#ffffff",position:J.BOTTOM_RIGHT,animation:K.NONE,shape:V.CIRCLE,width:22,height:22}},X=function(t,n){var e=new CustomEvent(t,{bubbles:!0,detail:n});document.dispatchEvent(e)},Y=window.matchMedia("(prefers-color-scheme: dark)"),Z=Object.keys,$=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!0},tt=function(t,n){var e,o,i=Z(n);if($(t)&&$(n))for(var r=0,c=i;r<c.length;r++){var a=c[r];$(n[a])?(t[a]||Object.assign(t,((e={})[a]={},e)),tt(t[a],n[a])):Object.assign(t,((o={})[a]=n[a],o))}return t},nt=function(t){return new Promise((function(n,e){var o=new Image;o.crossOrigin="anonymous",o.addEventListener("load",(function(){return n(o)}),{once:!0}),o.addEventListener("error",(function(t){return e(t)}),{once:!0}),o.src=t}))},et=function(){function t(t){if(this.userIconCache=null,this.badgeCounter=0,"undefined"==typeof window)console.warn("Favoritos was not initialised! Probably it is used in SSR.");else{var n=this.isPrefersColorSchemeDark(),e=Q;n&&(e.badge.color="#121212",e.badge.backgroundColor="#ffffff",e.icon.backgroundColor="#ffffff"),this.options=tt(e,t),this.init()}}return t.detectVisibilityChange=function(){"visible"===document.visibilityState?X("favoritos:visibilitychange","visible"):X("favoritos:visibilitychange","hidden")},t.detectThemeChange=function(t){console.log(t);var n=t.matches?"dark":"light";X("favoritos:themechange",n)},t.initListeners=function(){document.addEventListener("visibilitychange",t.detectVisibilityChange);try{Y.addEventListener("change",t.detectThemeChange)}catch(n){Y.addListener(t.detectThemeChange)}},t.prototype.initIconCanvas=function(){var t=this.options,n=t.icon,e=t.badge,o=e.width,i=e.height,r=n.width,c=n.height;this.badgeCanvasWidth=o,this.badgeCanvasHeight=i,this.iconCanvas=document.createElement("canvas"),this.iconCanvasWidth=r,this.iconCanvasHeight=c,this.iconCanvas.width=r,this.iconCanvas.height=c,this.iconCanvasContext=this.iconCanvas.getContext("2d"),this.iconCanvasContext.font=e.fontSize+"px "+e.fontFamily,this.iconCanvasContext.textAlign="center",this.iconCanvasContext.textBaseline="middle"},t.prototype.getContextBackgroundColor=function(t,n,e){var o,i,r,c=this.iconCanvasContext;if(Array.isArray(t)){var a=c.createLinearGradient(0,0,n,e);(r=1/(i=t).length,i.map((function(t,n){return[n*r,t]}))).map((function(t){a.addColorStop(t[0],t[1])})),o=a}else o=t;return o},t.prototype.init=function(){var n=this,e=this.options.icon;this.iconElement=document.querySelector(e.iconSelector),this.userIconHref=this.iconElement.href,nt(this.userIconHref).then((function(t){n.userIconCache=t})),this.initIconCanvas(),t.initListeners()},t.prototype.destroy=function(){document.removeEventListener("visibilitychange",t.detectVisibilityChange.bind(t)),Y.removeEventListener("change",t.detectThemeChange.bind(t)),document.removeEventListener("scroll",this.setScrollingProgressBar.bind(this))},t.prototype.setOptions=function(t){this.options=tt(this.options,t)},t.prototype.setIcon=function(t){this.iconElement.href=t},t.prototype.isPrefersColorSchemeDark=function(){return Y.matches},t.prototype.reset=function(){this.options=Q,this.setIcon(this.userIconHref)},t.prototype.drawBadge=function(t){var n=this,e=function(e){var o=n.badgeCounter,i=n.options.icon,r=n.options.badge;t&&(o=t,n.badgeCounter=t);var c=o>=100?10:o>=10?7:0;n.iconCanvasContext.clearRect(0,0,i.width,i.height),n.iconCanvasContext.drawImage(e,0,0,i.width,i.height),n.iconCanvasContext.fillStyle=n.getContextBackgroundColor(r.backgroundColor,n.iconCanvasWidth,n.iconCanvasHeight),n.iconCanvasContext.beginPath(),r.shape===V.CIRCLE?n.drawCircleBadge(o,i,r,c):n.drawRectBadge(i,r,c),n.iconCanvasContext.fill(),n.iconCanvasContext.fillStyle=r.color,n.iconCanvasContext.fillText(String(o),i.width-c/2-r.width/2,i.height-r.height/2+1.75,i.width),n.iconCanvasContext.closePath(),n.iconElement.href=n.iconCanvas.toDataURL("image/png",1),t||n.badgeCounter++};this.userIconCache?e(this.userIconCache):nt(this.userIconHref).then((function(t){n.userIconCache=t,e(t)}))},t.prototype.drawCircleBadge=function(t,n,e,o){var i,r,c,a,s,h,u,f,l,d,v;void 0===o&&(o=0),t>=10?(this.iconCanvasContext.strokeStyle=this.getContextBackgroundColor(e.backgroundColor,this.iconCanvasWidth,this.iconCanvasHeight),i=this.iconCanvasContext,r=n.width-e.width-o,c=n.height-e.height,a=e.width+o,s=e.height,h=10,u=r,f=c,l=a,d=s,v=Math.min(Math.max(a-1,1),Math.max(s-1,1),h),i.lineJoin="round",i.lineWidth=v,i.strokeRect(u+v/2,f+v/2,l-v,d-v),i.fillRect(u+v/2,f+v/2,l-v,d-v),i.stroke(),i.fill()):this.iconCanvasContext.arc(n.width-e.width/2,n.height-e.height/2,e.width/2,0,2*Math.PI)},t.prototype.drawRectBadge=function(t,n,e){void 0===e&&(e=0),this.iconCanvasContext.rect(t.width-n.width-e,t.height-n.height,n.width+e,n.height)},t.prototype.initScrollingProgressBar=function(){document.addEventListener("scroll",this.setScrollingProgressBar.bind(this))},t.prototype.setScrollingProgressBar=function(){var t=this.options.icon,n=document.documentElement.scrollTop/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;X("favoritos:scrolled",n),this.iconCanvasContext.clearRect(0,0,t.width,t.height),this.iconCanvasContext.beginPath(),this.iconCanvasContext.lineWidth=t.lineWidth,t.shape===V.CIRCLE?this.drawCircleProgress(n,t):this.drawRectProgress(n),this.iconCanvasContext.strokeStyle=this.getContextBackgroundColor(t.backgroundColor,32,32),this.iconCanvasContext.stroke(),this.iconElement.href=this.iconCanvas.toDataURL("image/png",1)},t.prototype.drawCircleProgress=function(t,n){this.iconCanvasContext.arc(n.width/2,n.height/2,n.width/2-n.lineWidth/2,1.5*Math.PI,2*t*Math.PI/100+1.5*Math.PI)},t.prototype.drawRectProgress=function(t){var n=this.iconCanvasContext;t<=25?(n.moveTo(0,0),n.lineTo(1.28*t,0)):t>25&&t<=50?(n.moveTo(0,0),n.lineTo(32,0),n.moveTo(32,0),n.lineTo(32,1.28*(t-25))):t>50&&t<=75?(n.moveTo(0,0),n.lineTo(32,0),n.moveTo(32,0),n.lineTo(32,32),n.moveTo(32,32),n.lineTo(-1.28*(t-75),32)):t>75&&t<=100&&(n.moveTo(0,0),n.lineTo(32,0),n.moveTo(32,0),n.lineTo(32,32),n.moveTo(32,32),n.lineTo(0,32),n.moveTo(0,32),n.lineTo(0,-1.28*(t-100)))},t}();module.exports=et;