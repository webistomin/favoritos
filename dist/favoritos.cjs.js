/**
* favoritos
*
* @version 1.0.0
* @author webistomin
* @email: webistomin@gmail.com
* @license: MIT
*
**/

"use strict";var t,e;!function(t){t.TOP_LEFT="top-left",t.TOP_RIGHT="top-right",t.BOTTOM_LEFT="bottom-left",t.BOTTOM_RIGHT="bottom-right"}(t||(t={})),function(t){t.CIRCLE="circle",t.RECT="rectangle"}(e||(e={}));var o={icon:{iconSelector:'link[rel*="icon"]',backgroundColor:"#d21f3c",shape:e.CIRCLE,lineWidth:4,width:32,height:32},badge:{fontSize:18,fontFamily:"Helvetica, Arial, sans-serif",backgroundColor:"#d21f3c",color:"#ffffff",position:t.BOTTOM_RIGHT,shape:e.CIRCLE,minWidth:22,minHeight:22},debug:{enabled:!1,debugSelector:"#favoritos-debug"}},n=Object.keys,i=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!0},s=function(t,e){var o,a,r=n(e);if(i(t)&&i(e))for(var c=0,h=r;c<h.length;c++){var g=h[c];i(e[g])?(t[g]||Object.assign(t,((o={})[g]={},o)),s(t[g],e[g])):Object.assign(t,((a={})[g]=e[g],a))}return t},a=function(t,e){var o=new Image;o.crossOrigin="anonymous",o.addEventListener("load",(function(){return e(o)}),{once:!0}),o.addEventListener("error",(function(){return e(o)}),{once:!0}),o.src=t},r=function(){function n(t){void 0===t&&(t={}),this.userIconCache=null,this.debugElement=null,this.arcDegrees={0:0,90:.5*Math.PI,180:Math.PI,270:1.5*Math.PI,360:2*Math.PI},"undefined"==typeof window?console.warn("Favoritos was not initialised! Probably it is used in SSR."):(this.options=s(o,t),this.init())}return n.prototype.init=function(){var t=this,e=this.options,o=e.icon,n=e.debug,i=n.enabled,s=n.debugSelector;this.iconElement=document.querySelector(o.iconSelector),this.iconElement?(this.userIconHref=this.iconElement.href,a(this.userIconHref,(function(e){t.userIconCache=e}))):console.warn('Favoritos: favicon element wasn\'t found \n Please, add <link rel="shortcut icon" href="..."> to head section'),i&&(this.debugElement=document.querySelector(s),this.debugElement||console.warn("Favoritos: debugger was enabled but debug element wasn't found")),this.initIconCanvas()},n.prototype.initIconCanvas=function(){var t=this.options,e=t.icon,o=t.badge,n=e.width,i=e.height,s=window.devicePixelRatio||1;this.iconCanvas=document.createElement("canvas"),this.iconCanvas.width=n*s,this.iconCanvas.height=i*s,this.iconCanvasContext=this.iconCanvas.getContext("2d"),this.iconCanvasContext.font=o.fontSize+"px "+o.fontFamily,this.iconCanvasContext.textAlign="center",this.iconCanvasContext.textBaseline="middle",this.iconCanvasContext.scale(s,s)},n.prototype.getContextBackgroundColor=function(t,e,o){var n,i,s,a=this.iconCanvasContext;if(Array.isArray(t)){var r=a.createLinearGradient(0,0,e,o);(s=1/((i=t).length-1),i.map((function(t,e){return[e*s,t]}))).map((function(t){r.addColorStop(t[0],t[1])})),n=r}else n=t;return n},n.prototype.setOptions=function(t){this.options=s(this.options,t)},n.prototype.setIcon=function(t){this.iconElement.href=t,this.userIconCache=null},n.prototype.reset=function(){var t=this.iconCanvasContext,e=this.options.icon,n=e.width,i=e.height;this.options=o,this.setIcon(this.userIconHref),t.clearRect(0,0,n,i),this.setDebugger(),delete this.badgeContent},n.prototype.drawImage=function(t){var e=this.iconCanvasContext,o=this.options.icon,n=o.width,i=o.height;"crossOrigin"in t&&(t.crossOrigin="anonymous"),e.drawImage(t,0,0,n,i),this.iconElement.href=this.iconCanvas.toDataURL("image/webp",1),this.setDebugger()},n.prototype.drawBadge=function(t){var o=this;void 0===t&&(t="");var n=function(n){o.badgeContent=t;var i=t,s=o.iconCanvasContext,a=o.options.icon,r=o.options.badge,c=r.fontSize,h=r.backgroundColor,g=r.shape,d=r.color,u=a.width,l=a.height,C=o.iconCanvasContext.measureText(String(i)).width,p=c;s.clearRect(0,0,u,l),s.drawImage(n,0,0,u,l),s.fillStyle=o.getContextBackgroundColor(h,u,l),s.beginPath(),g===e.CIRCLE?o.drawCircleBadge(C,p,i):o.drawRectBadge(C,p),s.fill(),s.fillStyle=d,s.fillText(String(i),o.getBadgeTextXPosition(C),o.getBadgeTextYPosition(p),u),s.closePath(),o.iconElement.href=o.iconCanvas.toDataURL("image/webp",1),o.setDebugger()};this.userIconCache?n(this.userIconCache):a(this.userIconHref,(function(t){o.userIconCache=t,n(t)}))},n.prototype.drawProgressBar=function(t,o){var n=this;void 0===o&&(o=!1);var i=this.userIconCache,s=function(o){var i=n.iconCanvasContext,s=n.options.icon,a=s.width,r=s.height,c=s.backgroundColor,h=s.lineWidth;i.clearRect(0,0,a,r),o&&i.drawImage(o,0,0,a,r),i.beginPath(),i.lineWidth=h,s.shape===e.CIRCLE?n.drawCircleProgressBar(t):n.drawRectProgressBar(t),i.strokeStyle=n.getContextBackgroundColor(c,a,r),i.stroke(),n.iconElement.href=n.iconCanvas.toDataURL("image/webp",1),n.setDebugger()};o?i?s(i):a(this.userIconHref,(function(t){n.userIconCache=t})):s()},n.prototype.getBadgeXPosition=function(o){var n=this.options,i=n.badge,s=i.minWidth,a=i.position,r=n.icon.width,c=n.badge.shape,h=r,g=this.badgeContent,d="number"==typeof g?g>=10:g.length>=1,u=s>=o?s:o>=h?h:o;switch(a){case t.TOP_LEFT:case t.BOTTOM_LEFT:switch(c){case e.CIRCLE:return d?0:u/2;case e.RECT:return 0}break;case t.TOP_RIGHT:case t.BOTTOM_RIGHT:switch(c){case e.CIRCLE:return d?r-u:r-u/2;case e.RECT:return r-u}}},n.prototype.getBadgeYPosition=function(o){var n=this.options,i=this.badgeContent,s=n.badge,a=s.position,r=s.minHeight,c=s.shape,h=n.icon.height,g="number"==typeof i?i>=10:i.length>=1,d=r>=o?r:o;switch(a){case t.TOP_LEFT:case t.TOP_RIGHT:switch(c){case e.CIRCLE:return g?0:d/2;case e.RECT:return 0}break;case t.BOTTOM_LEFT:case t.BOTTOM_RIGHT:switch(c){case e.CIRCLE:return g?h-d:h-d/2;case e.RECT:return h-d}}},n.prototype.getBadgeTextXPosition=function(e){var o=this.options,n=o.badge,i=n.position,s=n.minWidth,a=o.icon.width,r=s>=e?s:e>=a?a:e;switch(i){case t.TOP_RIGHT:case t.BOTTOM_RIGHT:return Math.abs(a-r/2);case t.TOP_LEFT:case t.BOTTOM_LEFT:return Math.abs(r/2)}},n.prototype.getBadgeTextYPosition=function(e){var o=this.options,n=o.badge,i=n.position,s=n.minHeight,a=o.icon.height,r="number"==typeof this.badgeContent?.085*e:0,c=s>=e?s:e;switch(i){case t.TOP_RIGHT:case t.TOP_LEFT:return Math.abs(c/2+r);case t.BOTTOM_RIGHT:case t.BOTTOM_LEFT:return Math.abs(a-c/2+r)}},n.prototype.drawCircleBadge=function(t,e,o){var n=this.options,i=n.icon,s=i.width,a=i.height,r=n.badge,c=r.minWidth,h=r.minHeight,g=r.backgroundColor,d=s,u=this.iconCanvasContext,l=c>=t?c:t>=d?d:t,C=h>=e?h:e;("number"==typeof o?o>=10:o.length>=1)?(u.strokeStyle=this.getContextBackgroundColor(g,s,a),function(t,e,o,n,i,s){var a=e,r=o,c=n,h=i,g=Math.min(Math.max(n-1,1),Math.max(i-1,1),s);t.lineJoin="round",t.lineWidth=g,t.strokeRect(a+g/2,r+g/2,c-g,h-g),t.fillRect(a+g/2,r+g/2,c-g,h-g),t.stroke(),t.fill()}(u,this.getBadgeXPosition(t),this.getBadgeYPosition(e),l,C,10)):u.arc(this.getBadgeXPosition(t),this.getBadgeYPosition(e),l/2,this.arcDegrees[0],this.arcDegrees[360])},n.prototype.drawRectBadge=function(t,e){var o=this.options,n=o.icon.width,i=o.badge,s=i.minWidth,a=i.minHeight,r=s>=t?s:t>=n?n:t,c=a>=e?a:e;this.iconCanvasContext.rect(this.getBadgeXPosition(t),this.getBadgeYPosition(e),r,c)},n.prototype.drawCircleProgressBar=function(t){var e=this.options,o=this.iconCanvasContext,n=e.icon,i=n.width,s=n.height,a=n.lineWidth;o.arc(i/2,s/2,i/2-a/2,this.arcDegrees[270],t*this.arcDegrees[360]/100+this.arcDegrees[270])},n.prototype.drawRectProgressBar=function(t){var e=this.options,o=this.iconCanvasContext,n=e.icon,i=n.width,s=n.height;t<=25?(o.moveTo(0,0),o.lineTo(i/25*t,0)):t>25&&t<=50?(o.moveTo(0,0),o.lineTo(i,0),o.moveTo(i,0),o.lineTo(i,s/25*(t-25))):t>50&&t<=75?(o.moveTo(0,0),o.lineTo(i,0),o.moveTo(i,0),o.lineTo(i,s),o.moveTo(i,s),o.lineTo(-i/25*(t-75),s)):t>75&&t<=100&&(o.moveTo(0,0),o.lineTo(i,0),o.moveTo(i,0),o.lineTo(i,s),o.moveTo(i,s),o.lineTo(0,s),o.moveTo(0,s),o.lineTo(0,-s/25*(t-100)))},n.prototype.setDebugger=function(){this.options.debug.enabled&&this.debugElement&&this.debugElement.appendChild(this.iconCanvas)},n}();module.exports=r;