/**
* favoritos
*
* @version 0.0.1-beta.0
* @author webistomin
* @email: webistomin@gmail.com
* @license: MIT
*
**/

"use strict";function t(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}var e=t((function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),n=t((function(t){var e=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=e)})),o=(n.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),i=function(t){if(!o(t))throw TypeError(t+" is not an object!");return t},r=function(t){try{return!!t()}catch(t){return!0}},a=!r((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),c=e.document,s=o(c)&&o(c.createElement),u=!a&&!r((function(){return 7!=Object.defineProperty((t="div",s?c.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),h=Object.defineProperty,f={f:a?Object.defineProperty:function(t,e,n){if(i(t),e=function(t,e){if(!o(t))return t;var n,i;if(e&&"function"==typeof(n=t.toString)&&!o(i=n.call(t)))return i;if("function"==typeof(n=t.valueOf)&&!o(i=n.call(t)))return i;if(!e&&"function"==typeof(n=t.toString)&&!o(i=n.call(t)))return i;throw TypeError("Can't convert object to primitive value")}(e,!0),i(n),u)try{return h(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},l=a?function(t,e,n){return f.f(t,e,function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}(1,n))}:function(t,e,n){return t[e]=n,t},d={}.hasOwnProperty,g=function(t,e){return d.call(t,e)},p=0,v=Math.random(),C=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++p+v).toString(36))},b=t((function(t){var o=e["__core-js_shared__"]||(e["__core-js_shared__"]={});(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:n.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),m=b("native-function-to-string",Function.toString),y=t((function(t){var o=C("src"),i=(""+m).split("toString");n.inspectSource=function(t){return m.call(t)},(t.exports=function(t,n,r,a){var c="function"==typeof r;c&&(g(r,"name")||l(r,"name",n)),t[n]!==r&&(c&&(g(r,o)||l(r,o,t[n]?""+t[n]:i.join(String(n)))),t===e?t[n]=r:a?t[n]?t[n]=r:l(t,n,r):(delete t[n],l(t,n,r)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[o]||m.call(this)}))})),T=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,o){return t.call(e,n,o)};case 3:return function(n,o,i){return t.call(e,n,o,i)}}return function(){return t.apply(e,arguments)}},O=function(t,o,i){var r,a,c,s,u=t&O.F,h=t&O.G,f=t&O.S,d=t&O.P,g=t&O.B,p=h?e:f?e[o]||(e[o]={}):(e[o]||{}).prototype,v=h?n:n[o]||(n[o]={}),C=v.prototype||(v.prototype={});for(r in h&&(i=o),i)c=((a=!u&&p&&void 0!==p[r])?p:i)[r],s=g&&a?T(c,e):d&&"function"==typeof c?T(Function.call,c):c,p&&y(p,r,c,t&O.U),v[r]!=c&&l(v,r,s),d&&C[r]!=c&&(C[r]=c)};e.core=n,O.F=1,O.G=2,O.S=4,O.P=8,O.B=16,O.W=32,O.U=64,O.R=128;var w,E,P=O,x={}.toString,_=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==function(t){return x.call(t).slice(8,-1)}(t)?t.split(""):Object(t)},I=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},S=function(t){return _(I(t))},B=Math.ceil,R=Math.floor,L=function(t){return isNaN(t=+t)?0:(t>0?R:B)(t)},M=Math.min,k=Math.max,j=Math.min,F=b("keys"),H=(w=!1,function(t,e,n){var o,i,r=S(t),a=(o=r.length)>0?M(L(o),9007199254740991):0,c=function(t,e){return(t=L(t))<0?k(t+e,0):j(t,e)}(n,a);if(w&&e!=e){for(;a>c;)if((i=r[c++])!=i)return!0}else for(;a>c;c++)if((w||c in r)&&r[c]===e)return w||c||0;return!w&&-1}),G=F[E="IE_PROTO"]||(F[E]=C(E)),W="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),A=Object.keys||function(t){return function(t,e){var n,o=S(t),i=0,r=[];for(n in o)n!=G&&g(o,n)&&r.push(n);for(;e.length>i;)g(o,n=e[i++])&&(~H(r,n)||r.push(n));return r}(t,W)},D={f:Object.getOwnPropertySymbols},N={f:{}.propertyIsEnumerable},X=function(t){return Object(I(t))},Y=Object.assign,q=!Y||r((function(){var t={},e={},n=Symbol(),o="abcdefghijklmnopqrst";return t[n]=7,o.split("").forEach((function(t){e[t]=t})),7!=Y({},t)[n]||Object.keys(Y({},e)).join("")!=o}))?function(t,e){for(var n=X(t),o=arguments.length,i=1,r=D.f,c=N.f;o>i;)for(var s,u=_(arguments[i++]),h=r?A(u).concat(r(u)):A(u),f=h.length,l=0;f>l;)s=h[l++],a&&!c.call(u,s)||(n[s]=u[s]);return n}:Y;P(P.S+P.F,"Object",{assign:q});t((function(t){var e=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=e)})).version;P(P.S+P.F,"Object",{assign:q});var z;n.Object.assign;!function(t){t.TOP_LEFT="top-left",t.TOP_RIGHT="top-right",t.BOTTOM_LEFT="bottom-left",t.BOTTOM_RIGHT="bottom-right"}(z||(z={}));var U,V;!function(t){t.CIRCLE="circle",t.RECT="rectangle"}(U||(U={})),function(t){t.NONE="none",t.POP="pop",t.SLIDE="slide",t.FADE="fade",t.POP_FADE="popfade"}(V||(V={}));var J={icon:{iconSelector:'link[rel*="icon"]',backgroundColor:"#d21f3c",shape:U.CIRCLE,lineWidth:4,width:32,height:32},badge:{fontSize:18,fontFamily:"Helvetica, Arial, sans-serif",backgroundColor:"#d21f3c",color:"#ffffff",position:z.BOTTOM_RIGHT,animation:V.NONE,shape:U.CIRCLE,width:22,height:22}},K=function(t,e){var n=new CustomEvent(t,{bubbles:!0,detail:e});document.dispatchEvent(n)},Q=window.matchMedia("(prefers-color-scheme: dark)"),Z=Object.keys,$=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!0},tt=function(t,e){var n,o,i=Z(e);if($(t)&&$(e))for(var r=0,a=i;r<a.length;r++){var c=a[r];$(e[c])?(t[c]||Object.assign(t,((n={})[c]={},n)),tt(t[c],e[c])):Object.assign(t,((o={})[c]=e[c],o))}return t},et=function(t){return new Promise((function(e,n){var o=new Image;o.crossOrigin="anonymous",o.addEventListener("load",(function(){return e(o)}),{once:!0}),o.addEventListener("error",(function(t){return n(t)}),{once:!0}),o.src=t}))},nt=function(){function t(t){if(this.userIconCache=null,this.badgeCounter=0,"undefined"==typeof window)console.warn("Favoritos was not initialised! Probably it is used in SSR.");else{var e=this.isPrefersColorSchemeDark(),n=J;e&&(n.badge.color="#121212",n.badge.backgroundColor="#ffffff",n.icon.backgroundColor="#ffffff"),this.options=tt(n,t),this.init()}}return t.detectVisibilityChange=function(){"visible"===document.visibilityState?K("favoritos:visibilitychange","visible"):K("favoritos:visibilitychange","hidden")},t.detectThemeChange=function(t){var e=t.matches?"dark":"light";K("favoritos:themechange",e)},t.initListeners=function(){document.addEventListener("visibilitychange",t.detectVisibilityChange);try{Q.addEventListener("change",t.detectThemeChange)}catch(e){Q.addListener(t.detectThemeChange)}},t.prototype.initIconCanvas=function(){var t=this.options,e=t.icon,n=t.badge,o=n.width,i=n.height,r=e.width,a=e.height;this.badgeCanvasWidth=o,this.badgeCanvasHeight=i,this.iconCanvas=document.createElement("canvas"),this.iconCanvasWidth=r,this.iconCanvasHeight=a,this.iconCanvas.width=r,this.iconCanvas.height=a,this.iconCanvasContext=this.iconCanvas.getContext("2d"),this.iconCanvasContext.font=n.fontSize+"px "+n.fontFamily,this.iconCanvasContext.textAlign="center",this.iconCanvasContext.textBaseline="middle"},t.prototype.getContextBackgroundColor=function(t,e,n){var o,i,r,a=this.iconCanvasContext;if(Array.isArray(t)){var c=a.createLinearGradient(0,0,e,n);(r=1/(i=t).length,i.map((function(t,e){return[e*r,t]}))).map((function(t){c.addColorStop(t[0],t[1])})),o=c}else o=t;return o},t.prototype.init=function(){var e=this,n=this.options.icon;this.iconElement=document.querySelector(n.iconSelector),this.userIconHref=this.iconElement.href,et(this.userIconHref).then((function(t){e.userIconCache=t})),this.initIconCanvas(),t.initListeners()},t.prototype.destroy=function(){document.removeEventListener("visibilitychange",t.detectVisibilityChange.bind(t)),Q.removeEventListener("change",t.detectThemeChange.bind(t)),document.removeEventListener("scroll",this.setScrollingProgressBar.bind(this))},t.prototype.setOptions=function(t){this.options=tt(this.options,t)},t.prototype.setIcon=function(t){this.iconElement.href=t},t.prototype.isPrefersColorSchemeDark=function(){return Q.matches},t.prototype.reset=function(){this.options=J,this.setIcon(this.userIconHref)},t.prototype.getBadgeXPosition=function(t,e){void 0===t&&(t=0);var n=this.options,o=n.badge.position,i=n.icon.width,r=n.badge.width,a=n.badge.shape,c=e>=10;switch(o){case z.TOP_LEFT:case z.BOTTOM_LEFT:switch(a){case U.CIRCLE:return c?0:r/2;case U.RECT:return 0}break;case z.TOP_RIGHT:case z.BOTTOM_RIGHT:switch(a){case U.CIRCLE:return c?i-r-t:i-r/2;case U.RECT:return i-r-t}}},t.prototype.getBadgeYPosition=function(t){var e=this.options,n=e.badge.position,o=e.icon.height,i=e.badge.height,r=e.badge.shape,a=t>=10;switch(n){case z.TOP_LEFT:case z.TOP_RIGHT:switch(r){case U.CIRCLE:return a?0:i/2;case U.RECT:return 0}break;case z.BOTTOM_LEFT:case z.BOTTOM_RIGHT:switch(r){case U.CIRCLE:return a?o-i:o-i/2;case U.RECT:return o-i}}},t.prototype.getBadgeTextXPosition=function(t){void 0===t&&(t=0);var e=this.options,n=e.badge.position,o=e.icon.width,i=e.badge.width;switch(n){case z.TOP_RIGHT:case z.BOTTOM_RIGHT:return Math.abs(o-t/2-i/2);case z.TOP_LEFT:case z.BOTTOM_LEFT:return Math.abs(t/2+i/2)}},t.prototype.getBadgeTextYPosition=function(){var t=this.options,e=t.badge.position,n=t.icon.height,o=t.badge.height;switch(e){case z.TOP_RIGHT:case z.TOP_LEFT:return Math.abs(o/2+1);case z.BOTTOM_RIGHT:case z.BOTTOM_LEFT:return Math.abs(n-o/2+1.75)}},t.prototype.drawBadge=function(t){var e=this,n=function(n){var o=e.badgeCounter,i=e.options.icon,r=e.options.badge;t&&(o=t,e.badgeCounter=t);var a=o>=100?10:o>=10?7:0;e.iconCanvasContext.clearRect(0,0,i.width,i.height),e.iconCanvasContext.drawImage(n,0,0,i.width,i.height),e.iconCanvasContext.fillStyle=e.getContextBackgroundColor(r.backgroundColor,e.iconCanvasWidth,e.iconCanvasHeight),e.iconCanvasContext.beginPath(),r.shape===U.CIRCLE?e.drawCircleBadge(o,i,r,a):e.drawRectBadge(o,i,r,a),e.iconCanvasContext.fill(),e.iconCanvasContext.fillStyle=r.color,e.iconCanvasContext.fillText(String(o),e.getBadgeTextXPosition(a),e.getBadgeTextYPosition(),i.width),e.iconCanvasContext.closePath(),e.iconElement.href=e.iconCanvas.toDataURL("image/png",1),document.body.append(e.iconCanvas),t||e.badgeCounter++};this.userIconCache?n(this.userIconCache):et(this.userIconHref).then((function(t){e.userIconCache=t,n(t)}))},t.prototype.drawCircleBadge=function(t,e,n,o){var i,r,a,c,s,u,h,f,l,d,g;void 0===o&&(o=0),t>=10?(this.iconCanvasContext.strokeStyle=this.getContextBackgroundColor(n.backgroundColor,this.iconCanvasWidth,this.iconCanvasHeight),i=this.iconCanvasContext,r=this.getBadgeXPosition(o,t),a=this.getBadgeYPosition(t),c=n.width+o,s=n.height,u=10,h=r,f=a,l=c,d=s,g=Math.min(Math.max(c-1,1),Math.max(s-1,1),u),i.lineJoin="round",i.lineWidth=g,i.strokeRect(h+g/2,f+g/2,l-g,d-g),i.fillRect(h+g/2,f+g/2,l-g,d-g),i.stroke(),i.fill()):this.iconCanvasContext.arc(this.getBadgeXPosition(o,t),this.getBadgeYPosition(t),n.width/2,0,2*Math.PI)},t.prototype.drawRectBadge=function(t,e,n,o){void 0===o&&(o=0),this.iconCanvasContext.rect(this.getBadgeXPosition(o,t),this.getBadgeYPosition(t),n.width+o,n.height)},t.prototype.initScrollingProgressBar=function(){document.addEventListener("scroll",this.setScrollingProgressBar.bind(this))},t.prototype.setScrollingProgressBar=function(){var t=this.options.icon,e=document.documentElement.scrollTop/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;K("favoritos:scrolled",e),this.iconCanvasContext.clearRect(0,0,t.width,t.height),this.iconCanvasContext.beginPath(),this.iconCanvasContext.lineWidth=t.lineWidth,t.shape===U.CIRCLE?this.drawCircleProgress(e,t):this.drawRectProgress(e),this.iconCanvasContext.strokeStyle=this.getContextBackgroundColor(t.backgroundColor,32,32),this.iconCanvasContext.stroke(),this.iconElement.href=this.iconCanvas.toDataURL("image/png",1),document.body.append(this.iconCanvas)},t.prototype.drawCircleProgress=function(t,e){this.iconCanvasContext.arc(e.width/2,e.height/2,e.width/2-e.lineWidth/2,1.5*Math.PI,2*t*Math.PI/100+1.5*Math.PI)},t.prototype.drawRectProgress=function(t){var e=this.iconCanvasContext;t<=25?(e.moveTo(0,0),e.lineTo(1.28*t,0)):t>25&&t<=50?(e.moveTo(0,0),e.lineTo(32,0),e.moveTo(32,0),e.lineTo(32,1.28*(t-25))):t>50&&t<=75?(e.moveTo(0,0),e.lineTo(32,0),e.moveTo(32,0),e.lineTo(32,32),e.moveTo(32,32),e.lineTo(-1.28*(t-75),32)):t>75&&t<=100&&(e.moveTo(0,0),e.lineTo(32,0),e.moveTo(32,0),e.lineTo(32,32),e.moveTo(32,32),e.lineTo(0,32),e.moveTo(0,32),e.lineTo(0,-1.28*(t-100)))},t}();module.exports=nt;